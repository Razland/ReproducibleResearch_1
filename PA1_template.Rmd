---
title: "Reproducible Research: "
output: 
  html_document:
    keep_md: true
---
## Peer Assessment #1
### Loading and preprocessing the data

_Conditionally (if not already present) download, unzip, and read-in data._

```{r loading}
library(dplyr, warn.conflicts=FALSE)
dataURL <- paste0("https://d396qusza40orc.cloudfront.",
                  "net/repdata%2Fdata%2Factivity.zip")
targFileName <- "data/repdata\ data\ activity.zip"
dataFileName <- "data/activity.csv"

if(!file.exists(dataFileName)) {            ## If not present, download file
  download.file(dataURL,                    ## from web and decompress 
               destfile = targFileName, 
               method = "curl")
  unzip(targFileName)
}

if(!"actDat" %in% ls()){                    ## If not already loaded,
  actDat <- read.csv(dataFileName)          ## read-in csv data file.
  actDat$date <- as.Date(actDat$date,       ## Change date to Posix format
                       format="%Y-%m-%d")
}
rm(dataURL, targFileName, dataFileName)     ## Cleanup temp data objects
```


### What is mean total number of steps taken per day?

-Make a histogram of the total number of steps taken each day:  
```{r meanStepsPlot}
plot(                                       ## H-plot the total steps/day
  na.omit(                                  ## Omits NaN and NA values
    summarize(
      group_by(
        actDat, date), 
          sum(steps, na.rm=TRUE))), 
  type="h",
  ylab="Total Steps",
  xlab="Date")
```

-Calculate and report the mean and median total number of steps taken per day:
```{r meanMedSteps}
print(
  paste(
    "Average Steps Per Day",
    mean(                                       ## Computes the mean of the sums
      na.omit(                                  ## for each day.  Omits NaN and
        summarize(                              ## NA values.
          group_by(
            actDat, 
            date), 
          sum(steps, 
              na.rm=TRUE)))$sum)))
print(
  paste(
    "Median Steps Per Day",
  median(                                     ## Computes the mid-point of the
    na.omit(                                  ## sums for each day.  Omits NaN 
      summarize(                              ## and NA values.
        group_by(
          actDat, 
          date), 
        sum(
          steps, 
          na.rm=TRUE)))$sum)))

```

### What is the average daily activity pattern?
-Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)  
```{r plotStepsInterval}
plot(                                       ## L-plot the average steps/interval
  na.omit(                                  ## Omits NaN and NA values
    summarize(
      group_by(
        actDat, interval), 
          mean(steps, na.rm=TRUE))), 
  type="l",
  ylab="Total Steps",
  xlab="5-Minute Interval")
```  

-Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

```{r maxStepsInterval}
totals <- summarize(
            group_by(actDat, interval), 
            sum(steps, na.rm=TRUE))
maxStep <- totals[totals$sum == max(totals$sum), c(1,2)]
hour <- as.integer(maxStep$interval/60)
minute <- ((maxStep$interval/60 - hour)/100) *60
print(paste0("Maximum activity is ", 
            maxStep$sum,
            " steps at ", 
            hour,
            ":",
            minute))

rm(totals, maxStep, hour, minute)

```
### Input missing values  
-Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs).  
```{r naValues}
# note that there is no such thing as "imputting"
sum(as.numeric(is.na(actDat[,1])))

```
-Devise a strategy for filling in all of the missing values in the datase. Create 
a new dataset that is equal to the original dataset but with the missing data 
filled in.  

_It is easily determined that NA values are clustered for entire days: in other
words, many days have no observations for steps._   

```{r showNADays}
for(date in unique(actDat$date)){           ## code chunk demonstrates that NA
  print(                                    ## values for step observations are
    paste0(                                 ## covering entire days by not using
      mean(actDat[actDat$date==date, 1]),   ## na.omit with the mean function.
           " ",                             ## Computes the step mean for each
           date))                           ## day of collections. Displays mean
  }                                         ## and POSIX unformatted day.

```  
_A valid solution would be to discard records with no valid entries for the day.
However, discarding the bad reading dates would not accomplish the instructions
from the assignment:_   

*"Create a new dataset that is equal to the original dataset but with the missing data filled in."*

_The best compromise solution would be to replace observation step NA values 
with 0 so as not to change the overall average:_  

```{r fillNA}
naReplace <-function(steps){                ## Substitutes daily mean for NA
  if(is.na(steps)){                         ## values. Returns a vector of 
    return(0)                               ## steps.
    }
  else{ 
    return(steps)
    }
  }

newActDat <-                                ## Create a new data frame with the
  data.frame(steps=as.numeric(              ## same sample labels.  Replace all
                     lapply(                ## NA values with the mean of all
                       actDat$steps,        ## days of data collections.
                       naReplace)), 
             date=actDat$date, 
             interval=actDat$interval)
dim(newActDat)                              ## show the size of the new data
head(newActDat)                             ## Show a sample of the new data
```   

-Make a histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the 
impact of imputing _(sic)_ missing data on the estimates of the total daily 
number of steps?

_Histogram_  

```{r corrDatHist}                          
plot(                                       ## H-plot the total steps/day.
  summarize(                                ## Omits NaN and NA values, same as
    group_by(                               ## above.
        newActDat, date), 
          sum(steps)), 
  type="h",
  ylab="Total Steps",
  xlab="Date")
```  
  
_Mean and Median daily values_  

```{r corrMeanMid}
print(
  paste(
    "Average Steps Per Day",
    mean(                                       ## Computes the mean of the sums
      summarize(                                ## for each day.  Omits NaN and
        group_by(                               ## NA values.
            newActDat, 
            date), 
          sum(steps))$sum)))
print(
  paste(
    "Median Steps Per Day",
  median(                                     ## Computes the mid-point of the
    summarize(                                ## sums for each day.  Omits NaN 
      group_by(                               ## and NA values.
          newActDat, 
          date), 
        sum(steps))$sum)))

```   

_Since the NA data were replaced with zero, the daily sums for the affected days 
have not changed.  The most recent histogram shows the same values as that of 
the original data, since the original plot omitted NA values_  

### Are there differences in activity patterns between weekdays and weekends?

-Create a new factor variable in the dataset with two levels – “weekday” and
“weekend” indicating whether a given date is a weekday or weekend day.  

```{r newFactor}
newActDat <- 
  mutate(newActDat,                         ## Adds new variable for weekday 
         weekday = !grepl("S[a-z]*day",     ## as a boolean. Uses regexp to 
                          as.character(     ## detect day names beginning with
                            lapply(         ## "S" and ending in "day."
                              newActDat$date, 
                              weekdays))))
dim(newActDat)
head(newActDat)
```  

-Make a panel plot containing a time series plot (i.e. type = "l") of the 5-
minute interval (x-axis) and the average number of steps taken, averaged across 
all weekday days or weekend days (y-axis).  

```{r panelPlot}

par(mfrow = c(2,1),                         ## Sets up multipanel plots and 
    pin = c(10, 10),                        ## other aesthetics.
    mar = c(.5,2,0,0),
    oma = c(1,1,0,0),
    lab = c(10, 6, 5))
plot(                                       ## L-plot the average steps/interval
  summarize(                                ## for weekdays. Omits NaN and NA
    group_by(                               ## values. 
      newActDat[newActDat$weekday==TRUE,], 
      interval), 
        mean(steps)), 
  type = "l",
  xaxt = "n",                               ## Omits x axis for the top graph
  ylim = c(0,210),
  xlim = c(0,2355),                         ## but sets x axis interval to match
  cex.axis = .7)
text(1150, 210, "Weekday",                  ## Labels plot data
     pos = 1, cex = .8)
par(mar = c(2,2,0,0))                       ## Modifies the margin for plot 2

plot(                                       ## L-plot the average steps/interval
  summarize(                                ## for weekend data. Omits NaN and
    group_by(                               ## NA values.
      newActDat[newActDat$weekday==FALSE,], 
      interval), 
        mean(steps)), 
  type="l",
  ylim = c(0,210),
  xlim = c(0,2355),
  cex.axis = .7 )
text(1150, 210, "Weekend",                   ## Labels the plot
     pos = 1, cex = .8)
mtext("Number of Steps",                     ## Labels the shared axes
      side = 2, 
      outer = TRUE)
mtext("Interval", 
      side = 1, 
      outer = TRUE)
rm(newActDat)                                ## Cleanup temp data frame
```  
________________________________________________________________________________
